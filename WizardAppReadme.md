# SDK Wizard Generated App Overview

This app was generated by the SDK Wizard.  The following provides an overview of the generated code and a few suggestions on where to go to customize the app.

## Table of Contents

- [SDK Wizard Generated App Overview](#sdk-wizard-generated-app-overview)
  - [Table of Contents](#table-of-contents)
  - [SDK Version](#sdk-version)
  - [Adding Libraries](#adding-libraries)
  - [Network Requests](#network-requests)
  - [Proxy Classes](#proxy-classes)
  - [Service Class](#service-class)
  - [Onboarding Customizations](#onboarding-customizations)
  - [Add a Custom Menu](#add-a-custom-menu)
  - [Architecture Components](#architecture-components)
  - [Offline Support](#offline-support)
    - [Customization of Offline Data Set](#customization-of-offline-data-set)
    - [Server Assigned Key and Offline Usage](#server-assigned-key-and-offline-usage)
  - [Identification Property](#identification-property)
  - [Detail Screens](#detail-screens)
  - [Show a Custom Screen](#show-a-custom-screen)
  - [Push Notifications](#push-notifications)
  - [Troubleshooting](#troubleshooting)

## SDK Version

The SDK version used by the application is set in the gradle.properties (for Project) file.
```text
sdkVersion=6.0.0
```

## Adding Libraries

Additional SDK libraries such as the Offline OData library can be added by editing app's build.gradle (Module:app) file in the dependencies section as shown below.
```text
// SAP BTP SDK for Android dependencies
implementation group: 'com.sap.cloud.android', name: 'foundation', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'onboarding-compose', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'flows-compose', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'fiori-composable-theme', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'fiori-compose-ui', version: sdkVersion

implementation group: 'com.sap.cloud.android', name: 'odata', version: sdkVersion
implementation group: 'com.sap.cloud.android', name: 'offline-odata', version: sdkVersion
```

## Network Requests

The app is designed to use a single OkHttpClient which is configured when the app is started. If you wish to make a network request (such as to initialize ImageLoader to fetch images online) to mobile services, you can access an instance of the OkHttpClient using the following code.
```kotlin
PainterBuilder.setupImageLoader(
    application, ClientProvider.get()
)
```

## Proxy Classes

The Wizard-generated application leverages both service (`EntityContainer`) and proxy (`Entity`) classes generated by the OData gradle plugin to interact with the specified mobile application hosted in SAP Mobile Services. Code generated by the OData gradle plugin can be found under the `app/build/generated/source/odata directory`.  The settings for the proxy generation are in the app's `build.gradle` file under an odata section.

Should the OData service change its metadata, corresponding classes will be regenerated on execution of relevant gradle tasks. It will impact the existing application if changes are not compatible.  See documentation for what constitutes compatible changes.  `SAPServiceManager` is responsible for instantiating the generated service class.

## Service Class

If you wish to make an OData query, you can access an instance of the service class using the below code. This example is from the service class generated against the sample back end.

```kotlin
//get the DataService class which we will use to query the Back-End OData service
val eSPMContainer = SAPServiceManager.eSPMContainer!!

val query = DataQuery()
        .filter(ProductCategory.numberOfProducts.greaterThan(0))
        .orderBy(ProductCategory.mainCategoryName)
        .orderBy(ProductCategory.categoryName)
espmContainer.executeQuery(query)
```

## Onboarding Customizations

A few of the Welcome screen customizations include the title, app icon, description and privacy terms of service URL.
For additional details consult [Customizing the Welcome Screen](https://help.sap.com/doc/c2d571df73104f72b9f1b73e06c5609a/Latest/en-US/docs/fioriui/onboarding/launchscreenactivity_layout.html#customizing-the-welcome-screen).

## Add a Custom Menu

The following steps will add a custom menu to the `EntitySetScreen`.

In `EntitySetScreen.kt`, add new action item to the `actionItems` list.
```kotlin
ActionItem(
  nameRes = "Custom Menu",
  overflowMode = OverflowMode.ALWAYS_OVERFLOW,
  doAction = { LOGGER.debug("Custom menu clicked.") } 
)
```

## Architecture Components

This version utilize Android's new Architecture Components:
- UI Layer
  - UI Element
    - Separate UI elements and ViewModel responsibility
    - UI elements that render the data on the screen.
    - Build with Jetpack compose functions
    - Using navigation component to navigate between composable
  - ViewModel hold data, expose it to the UI, and handle logic
    - Compose screen (View) and a ViewModel per screen
    - Share a viewmodel with entity list and edit, detail screen
    - Reactive UIs using Flow and coroutines for asynchronous operations.
- Data Layer Support pagination with offline odata client lib
- Adopt compose version flow and Fiori compose UI,

Each entity set will have its own set of screens, view model. When using the generated application as a starting point for development, unnecessary entity types can be purged by simply removing the corresponding files:

- src/.../<package_name>/ui/odata/screens (directory): <entity_set>
- src/.../<package_name>/ui/odata/viewmodel (directory): <entity_set>

In addition, update the following files to remove reference to the unwanted entity set

- src/.../<package_name>/ui/odata/EntityViewModelFactory.kt
- src/.../<package_name>/ui/odata/screens/EntitySetsScreen.kt
- res/AndroidManifest.xml

## Offline Support

During offline application generation, a defining request, which  queries the entire collection, will be generated for each entity set within the entity container. Thereafter, user can perform CRUD operations against local data offline. Local changes can be applied to the OData service when online through synchronization (upload followed by download). Local offline store is encrypted using a random string derived from the EncryptionUtil.getEncryptionKey method. While this is a security best practice, in the event the offline store needs to be submitted for support purposes, the encryption key must be extracted via a debug session or change the application to skip encryption.

### Customization of Offline Data Set

Defining requests can be changed in OfflineWorkerUtil's initializeOffline method. By default, all data within each entity is downloaded. This is not normally done for a typical offline application as only a subset of the data is brought onto the device. For best practices of offline data definition, please refer to offline section of SDK documentation.

### Server Assigned Key and Offline Usage

The generated application assumes that primary key(s) is assigned by the server. For online use case, the server key will be returned in the response of the operation. However, in offline use case, the key(s) is absent until an explicit synchronization is triggered through the main menu on the home screen. Hence, in create and update screens, the key(s) is not visible. It is not advisable to initialize the key(s) due to the potential of duplicate key. While it is possible to generate random key values, it is not good for user experience as key value will change after synchronization. Hence, the compromise is to exclude them in create/edit screens.

## Identification Property

For each entity set, a random non-key property is selected to identify an instance of corresponding entity type. This property is also used to sort the returned collection. For an app generated against the SAP Sample Service Back End OData service, the City property for the Customers entity set is selected. To change to a different property, the followng three files for the Customers entity set are to be updated: (search for Customer.city and replaced with another property in the Customer entity set)
- CustomerODataViewModel.kt
- CustomerEntitiesScreen.kt
- CustomerEntityDetailScreen.kt
- ODataMetaData.kt

Note: it is best to select a property that normally does not have null values. In some cases, perhaps the key property is appropriate.

## Detail Screens

The detail screen shows each property of the entity. The set of properties to be displayed can be changed by modifying the entity detail screen. For example, the Customers entity set will have the following screen files:
- CustomerEntityDetailScreen.kt (detail)
- CustomerEntityEditScreen.kt (create and update)

## Show a Custom Screen

The first screen shown following the onboarding screens is the `EntitySetScreen` screen.  To instead show a different screen, modify `ODataNavHost.kt`'s `startDestination` parameter and add call `NavGraphBuilder.composable` method, make the change below.
```kotlin
composable(route = "/myscreen_route") {
  MyScreen() 
}
```

## Push Notifications
//TODO:

If the option Enable Push was checked on the Project Configuration page of the wizard, classes to enable the app to receive push notifications appear in the package `fcm`.  One customization might be to change the title of the notification message if it is not included in the received message.  To do this, edit `PushNotificationBroadcastReceiver.java` and in the `onReceive` method modify the value of notificationTitle.

## Troubleshooting

While you are syncing the project, a `warning message` can appear in Android Studio.
"Could not find google-services.json while looking in [src/nullnull/debug, src/debug/nullnull, src/nullnull, src/debug, src/nullnullDebug]
registerResGeneratingTask is depricated, use registerGeneratedResFolders(FileCollection)"

You can ignore this warning message, it won't cause any problem.
